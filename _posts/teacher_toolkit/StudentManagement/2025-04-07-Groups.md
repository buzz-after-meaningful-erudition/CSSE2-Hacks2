---
layout: post
title: Create or Join a Group
type: issues
permalink: /teacher-toolkit/groups
comments: false
---
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        background-color: #f5f5f5;
    }
    .container {
        max-width: 1000px;
        margin: 0 auto;
        background-color: #121212;
        padding: 20px;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }
    h1 {
        text-align: center;
        color: #333;
    }
    .tabs {
        display: flex;
        margin-bottom: 20px;
        border-bottom: 1px solid #ddd;
    }
    .tab {
        padding: 10px 20px;
        cursor: pointer;
        background-color: #121212;
        border: 1px solid #ddd;
        border-bottom: none;
        border-radius: 5px 5px 0 0;
        margin-right: 5px;
    }
    .tab.active {
        background-color: #737373;
        border-bottom: 1px solid white;
        margin-bottom: -1px;
    }
    .tab-content {
        display: none;
        padding: 20px;
        border: 1px solid #ddd;
        border-top: none;
        border-radius: 0 0 5px 5px;
    }
    .tab-content.active {
        display: block;
    }
    .form-group {
        margin-bottom: 15px;
    }
    label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
    }
    input, select {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-sizing: border-box;
    }
    button {
        padding: 10px 15px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        margin-right: 10px;
    }
    button:hover {
        background-color: #45a049;
    }
    .person-list {
        max-height: 300px;
        overflow-y: auto;
        border: 1px solid #ddd;
        padding: 10px;
        margin-bottom: 15px;
    }
    .person-item {
        padding: 8px;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .person-item:last-child {
        border-bottom: none;
    }
    .person-item button {
        padding: 5px 10px;
        font-size: 12px;
    }
    .person-checkbox {
        margin-right: 10px;
    }
    .selected-people {
        margin-top: 20px;
        padding: 10px;
        background-color: #121212;
        border-radius: 4px;
    }
    .selected-person {
        display: inline-block;
        padding: 5px 10px;
        background-color: #121212;
        border-radius: 3px;
        margin-right: 5px;
        margin-bottom: 5px;
    }
    .selected-person button {
        background: none;
        border: none;
        color: #ff4d4d;
        cursor: pointer;
        padding: 0 5px;
        font-size: 14px;
    }
    .group-list {
        margin-top: 20px;
    }
    .group-item {
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
        margin-bottom: 10px;
        background-color: #222222;
    }
    .group-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
    }
    .group-name {
        font-weight: bold;
        font-size: 18px;
    }
    .group-period {
        color: #666;
    }
    .group-members {
        font-size: 14px;
    }
    .member-tag {
        display: inline-block;
        padding: 3px 8px;
        background-color: #e1e1e1;
        border-radius: 3px;
        margin-right: 5px;
        margin-bottom: 5px;
    }
</style>

<div class="container">
    <h1>Group Management</h1>
    <div class="tabs">
        <div class="tab active" data-tab="join">Join a Group</div>
        <div class="tab" data-tab="create">Create a Group</div>
    </div>
    <div id="join-tab" class="tab-content active">
        <h2>Available Groups</h2>
        <div class="group-list" id="available-groups">
            <!-- Groups will be displayed here -->
            <div class="loading">Loading groups...</div>
        </div>
    </div>
    <div id="create-tab" class="tab-content">
        <h2>Create a New Group</h2>
        <form id="create-group-form">
            <div class="form-group">
                <label for="group-name">Group Name:</label>
                <input type="text" id="group-name" required>
            </div>
            <div class="form-group">
                <label for="group-period">Period:</label>
                <input type="text" id="group-period" required>
            </div>
            <div class="form-group">
                <label>Select Group Members:</label>
                <div class="person-list" id="person-list">
                    <!-- People will be displayed here -->
                    <div class="loading">Loading people...</div>
                </div>
            </div>
            <div class="selected-people" id="selected-people">
                <h3>Selected People:</h3>
                <div id="selected-people-list">
                    <!-- Selected people will appear here -->
                    <div class="empty-selection">No people selected</div>
                </div>
            </div>
            <button type="submit">Create Group</button>
        </form>
    </div>
</div>

<script>
    // Tab functionality
    document.querySelectorAll('.tab').forEach(tab => {
        tab.addEventListener('click', function() {
            // Remove active class from all tabs and content
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // Add active class to clicked tab and corresponding content
            this.classList.add('active');
            document.getElementById(`${this.dataset.tab}-tab`).classList.add('active');
        });
    });

    // Global variables
    let allPeople = [];
    let selectedPeople = [];
    let allGroups = [];

    // Fetch all people on page load
    document.addEventListener('DOMContentLoaded', function() {
        fetchPeople();
        fetchGroups();
    });

    // Fetch people from API
    function fetchPeople() {
        fetch('/api/people')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                allPeople = data;
                renderPeopleList();
            })
            .catch(error => {
                document.getElementById('person-list').innerHTML = 
                    `<div class="error">Error loading people: ${error.message}</div>`;
            });
    }

    // Fetch groups from API
    function fetchGroups() {
        fetch('/api/groups')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                allGroups = data;
                renderGroupList();
            })
            .catch(error => {
                document.getElementById('available-groups').innerHTML = 
                    `<div class="error">Error loading groups: ${error.message}</div>`;
            });
    }

    // Render people list
    function renderPeopleList() {
        const personList = document.getElementById('person-list');
        if (allPeople.length === 0) {
            personList.innerHTML = '<div class="empty">No people available</div>';
            return;
        }

        personList.innerHTML = allPeople.map(person => `
            <div class="person-item">
                <div>
                    <input type="checkbox" class="person-checkbox" id="person-${person.id}" 
                            data-id="${person.id}" data-uid="${person.uid}" data-name="${person.name}">
                    <label for="person-${person.id}">${person.name} (${person.email})</label>
                </div>
            </div>
        `).join('');

        // Add event listeners to checkboxes
        document.querySelectorAll('.person-checkbox').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const personId = this.dataset.id;
                const personUid = this.dataset.uid;
                const personName = this.dataset.name;
                
                if (this.checked) {
                    if (!selectedPeople.some(p => p.id === personId)) {
                        selectedPeople.push({
                            id: personId,
                            uid: personUid,
                            name: personName
                        });
                    }
                } else {
                    selectedPeople = selectedPeople.filter(p => p.id !== personId);
                }
                
                renderSelectedPeople();
            });
        });
    }

    // Render selected people
    function renderSelectedPeople() {
        const selectedPeopleList = document.getElementById('selected-people-list');
        if (selectedPeople.length === 0) {
            selectedPeopleList.innerHTML = '<div class="empty-selection">No people selected</div>';
            return;
        }

        selectedPeopleList.innerHTML = selectedPeople.map(person => `
            <div class="selected-person" data-id="${person.id}">
                ${person.name}
                <button class="remove-person" data-id="${person.id}">Ã—</button>
            </div>
        `).join('');

        // Add event listeners to remove buttons
        document.querySelectorAll('.remove-person').forEach(button => {
            button.addEventListener('click', function() {
                const personId = this.dataset.id;
                selectedPeople = selectedPeople.filter(p => p.id !== personId);
                
                // Uncheck the corresponding checkbox
                const checkbox = document.querySelector(`.person-checkbox[data-id="${personId}"]`);
                if (checkbox) {
                    checkbox.checked = false;
                }
                
                renderSelectedPeople();
            });
        });
    }

    // Render group list
    function renderGroupList() {
        const groupList = document.getElementById('available-groups');
        if (allGroups.length === 0) {
            groupList.innerHTML = '<div class="empty">No groups available</div>';
            return;
        }

        groupList.innerHTML = allGroups.map(group => `
            <div class="group-item">
                <div class="group-header">
                    <div class="group-name">${group.name}</div>
                    <div class="group-period">Period: ${group.period}</div>
                </div>
                <div class="group-members">
                    <strong>Members (${group.members.length}):</strong>
                    <div>
                        ${group.members.map(member => `
                            <span class="member-tag">${member.name}</span>
                        `).join('')}
                    </div>
                </div>
                <button class="join-group-btn" data-id="${group.id}">Join Group</button>
            </div>
        `).join('');

        // Add event listeners to join buttons
        document.querySelectorAll('.join-group-btn').forEach(button => {
            button.addEventListener('click', function() {
                const groupId = this.dataset.id;
                joinGroup(groupId);
            });
        });
    }

    // Join a group
    function joinGroup(groupId) {
        // In a real application, we would fetch the current user's ID
        // For now, we'll simulate this with a mock current user ID
        const currentUserId = getCurrentUserId();
        
        if (!currentUserId) {
            alert('You must be logged in to join a group');
            return;
        }

        fetch(`/api/groups/${groupId}/addPeople`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify([currentUserId])
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            alert('Successfully joined the group!');
            fetchGroups(); // Refresh the groups list
        })
        .catch(error => {
            alert(`Error joining group: ${error.message}`);
        });
    }

    // Create a group
    document.getElementById('create-group-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const groupName = document.getElementById('group-name').value;
        const groupPeriod = document.getElementById('group-period').value;
        
        if (selectedPeople.length === 0) {
            alert('Please select at least one person for the group');
            return;
        }

        const groupData = {
            name: groupName,
            period: groupPeriod,
            personUids: selectedPeople.map(person => person.uid)
        };

        fetch('/api/groups', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(groupData)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            alert('Group created successfully!');
            // Reset form
            document.getElementById('create-group-form').reset();
            selectedPeople = [];
            renderSelectedPeople();
            // Uncheck all checkboxes
            document.querySelectorAll('.person-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            // Switch to join tab and refresh groups
            document.querySelector('.tab[data-tab="join"]').click();
            fetchGroups();
        })
        .catch(error => {
            alert(`Error creating group: ${error.message}`);
        });
    });

    // Helper function to get current user ID (this would be different in a real app)
    function getCurrentUserId() {
        // In a real application, you would get this from the session or authentication context
        // For now, we'll just mock a user ID
        return 1; // Mock user ID
    }
</script>
